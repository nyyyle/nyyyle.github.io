<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script defer src="https://unpkg.com/p5.collide2d"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js" integrity="sha512-uaz5GpnQoE6t5echKlX8P52czvsIGgLPcvlzfvRubLZ1Hp8JemUDnbUiAahbVtPb+jUVrNETuXvAhDDF/N3M4w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Micro+5&family=Pixelify+Sans:wght@500&family=Playfair+Display:wght@500&display=swap" rel="stylesheet">
    <style>
        body{
            margin: 0;
            padding: 0;
            overflow: hidden;
            border: none;
        }
        #Rbutton{
            margin: 0;
            padding: 0;
            overflow: hidden;
            border: none;
            background-image: url("redCar.png");
            position: absolute;
            z-index: 1;
            top: 831.1px;
            left: 108px;
            transform: translate(-279.85px,-100.75px);
            height: 201.5px;
            width: 559.7px;
        }
        #Ybutton{
            margin: 0;
            padding: 0;
            overflow: hidden;
            border: none;
            background-image: url("yellowCar.png");
            position: absolute;
            z-index: 1;
            top: 750.6px;
            left: 667.7px;
            transform: translate(-279.85px,-100.75px);
            height: 201.5px;
            width: 559.7px;
        }
        #Gbutton{
            margin: 0;
            padding: 0;
            overflow: hidden;
            border: none;
            background-image: url("greyCar.png");
            position: absolute;
            z-index: 1;
            top: 806.1px;
            left: 1282.8px;
            transform: translate(-279.85px,-100.75px);
            height: 201.5px;
            width: 559.7px;
        }
        #timer{
            top: 100px;
            left: 50%;
            transform: translate(-50%,-50%);
            height: 50px;
            width: 100px;
        }
    </style>
</head>
<body>
    <script>
		function gameStart(){
			const nrows = Math.floor(innerHeight / 45) - 6
			const ncols = Math.floor(innerWidth / 45) - 1
			const user = `<img src="yellowCar.png" height="27px" width="27px"></img>`
			const end = `<img src="redCar.png" height="27px" width="27px"></img>`

		function createCells() {
			for (let i = 0; i < nrows; i++) {
				let row = document.createElement("div")
				row.classList.add("row")

				if (i === 0) row.classList.add("first-row")
					document.body.appendChild(row)

				for (let j = 0; j < ncols; j++) {
					let col = document.createElement("div")
					col.classList.add("cell")
				if (j === 0) col.classList.add("first-col")
					row.appendChild(col)
			}
			}
		}

		createCells()

		class Cell {
			constructor(i, j) {
			this.r = i
			this.c = j

			this.neighbors = []
			this.walls = [true, true, true, true]
			this.visited = false
			}
		
			show() {
			if (!this.walls[0])
				cellElements[this.r * ncols + this.c].style["border-top"] = "none"
			if (!this.walls[1])
				cellElements[this.r * ncols + this.c].style["border-right"] = "none"
			if (!this.walls[2])
				cellElements[this.r * ncols + this.c].style["border-bottom"] = "none"
			if (!this.walls[3])
				cellElements[this.r * ncols + this.c].style["border-left"] = "none"

			if (this.visited)
				cellElements[this.r * ncols + this.c].style.background = "greenyellow"
			}

			createNeighbors() {
				// top
				if (this.r > 0) this.neighbors.push(grid[(this.r - 1) * ncols + this.c])
				// right
				if (this.c < ncols - 1)
				this.neighbors.push(grid[this.r * ncols + (this.c + 1)])
				// bottom
				if (this.r < nrows - 1)
					this.neighbors.push(grid[(this.r + 1) * ncols + this.c])
				// left
				if (this.c > 0) this.neighbors.push(grid[this.r * ncols + (this.c - 1)])
			}

			fix() {
				if (!this.walls[1] && !this.walls[2])
					cellElements[this.r * ncols + this.c].classList.add("bottomRightCorner")
			}
		}

		function fillGrid() {
			for (let i = 0; i < nrows; i++) {
				grid.push(new Cell(i, j))
			}
			for (let j = 0; j < ncols; j++) {
				grid.push(new Cell(i, j))
			}
		}

		for (let i = 0; i < nrows; i++) {
			grid[i * ncols + j].createNeighbors()
		}

		for (let j = 0; j < ncols; j++) {
			grid[i * ncols + j].createNeighbors()
		}

		let cellElements = document.querySelectorAll(".cell")
		let grid = []
		fillGrid()

		let current = grid[0]
		let stack = []
		let play = false
		let goal = grid[nrows * ncols - 1]
		let drawLoop = setInterval(animate, 50)
		let canAnimate = true
		let popUps = []

		// cause of my brain cell hurting: HOW MAZES WORK
		function BacktrackingDFS() {
			// change color if working properly
			cellElements[current.r * ncols + current.c].style.background = "olive"

			if (!current.visited) {
				current.visited = true
			stack.push(current)
			}

			let unvisited = []

			for (let neigh of current.neighbors) {
				if (!neigh.visited) {
				unvisited.push(neigh)
				}
			}

			if (unvisited.length > 0) {
				let randomIndex = Math.floor(Math.random() * unvisited.length)
				let next = unvisited[randomIndex]

				//Remove Walls
				if (current.r - next.r === 1) {
					//TOP
					current.walls[0] = false
					next.walls[2] = false
				} 
				else if (current.c - next.c === -1) {
					//RIGHT
					current.walls[1] = false
					next.walls[3] = false
				} 
				else if (current.r - next.r === -1) {
					//BOTTOM
					current.walls[2] = false
					next.walls[0] = false
				} 
				else if (current.c - next.c === 1) {
					//LEFT
					current.walls[3] = false
					next.walls[1] = false
				}

				current = next
			} 
			else if (stack.length > 0) {
				current = stack.pop()
			} 
			else {
				clearInterval(drawLoop)
				play = true
				cellElements[current.r * ncols + current.c].style.background = "greenyellow"
				cellElements[goal.r * ncols + goal.c].innerHTML = end
				cellElements[current.r * ncols + current.c].innerHTML = user
			}
		}

		function animate() {
			for (let i = 0; i < nrows; i++) {
				grid[i * ncols + j].show()
			}
			for (let j = 0; j < ncols; j++) {
				grid[i * ncols + j].show()
			}

			for (let i = 0; i < nrows; i++) {
				grid[i * ncols + j].fix()
			}
			for (let j = 0; j < ncols; j++) {
				grid[i * ncols + j].fix()
			}
			BacktrackingDFS()
		}

		// GAME PLAY PHASE BEGINS HERE
		let btn = document.querySelector(".generate-maze")
		btn.addEventListener("click", function () {
			clearInterval(drawLoop)
			for (let popUp of popUps) {
				popUp.style.display = "none"
			}
			for (let i = 0; i < nrows; i++) {
				cellElements[i * ncols + j].removeAttribute("style")
				cellElements[i * ncols + j].classList.remove("bottomRightCorner")
				cellElements[i * ncols + j].innerHTML = ""
			}
			for (let j = 0; j < ncols; j++) {
				cellElements[i * ncols + j].removeAttribute("style")
				cellElements[i * ncols + j].classList.remove("bottomRightCorner")
				cellElements[i * ncols + j].innerHTML = ""
			}

			grid = []
			fillGrid()
			current = grid[0]
			stack = []
			play = false
			goal = grid[nrows * ncols - 1]
			if (canAnimate) drawLoop = setInterval(animate, 50)
			else {
				while (!play) {
				animate()
				}
			}
		})

		document.body.addEventListener("keydown", function (event) {
			if (play) {
				cellElements[current.r * ncols + current.c].innerHTML = ``
				if (event.key === "ArrowUp") upArrowPressed()
				if (event.key === "ArrowLeft") leftArrowPressed()
				if (event.key === "ArrowRight") rightArrowPressed()
				if (event.key === "ArrowDown") downArrowPressed()
				cellElements[current.r * ncols + current.c].innerHTML = cat
				checkWin()
			}
		})

		// if the user wins
		function checkWin() {
			if (current === goal) {
				play = false
			}
		}

		// base controls
		function upArrowPressed() {
			if (!current.walls[0]) current = grid[(current.r - 1) * ncols + current.c]
	
		}
		function leftArrowPressed() {
			if (!current.walls[3]) current = grid[current.r * ncols + (current.c - 1)]
	
		}
		function rightArrowPressed() {
			if (!current.walls[1]) current = grid[current.r * ncols + (current.c + 1)]
	
		}
		function downArrowPressed() {
			if (!current.walls[2]) current = grid[(current.r + 1) * ncols + current.c]
	
		}}
    </script>
</body>
</html>
